# ğŸ”¥ çˆ†æ–‡å†…å®¹å‘å¸ƒç³»ç»Ÿ - å…¬å¸APIç‰ˆ

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäº**å…¬å¸API**çš„çˆ†æ–‡å‘å¸ƒç³»ç»Ÿï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼š
- âœ… è‡ªåŠ¨ç”Ÿæˆçˆ†æ–‡å†…å®¹ï¼ˆCSV â†’ APIï¼‰
- âœ… ç§»åŠ¨ç«¯H5å±•ç¤ºç•Œé¢
- âœ… ä¸€é”®å‘å¸ƒåˆ°å…¬å¸å†…å®¹åº“
- âœ… äºŒç»´ç æ‰«ç è®¿é—®
- âœ… è‡ªåŠ¨æå–æ ‡ç­¾å’Œæ¸…ç†æ ¼å¼

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤1: å®‰è£…ä¾èµ–

```bash
pip install -r requirements_xiaohongshu.txt
```

### æ­¥éª¤2: ç”Ÿæˆçˆ†æ–‡æ•°æ®

```bash
python convert_to_csv.py
```

### æ­¥éª¤3: æµ‹è¯•å…¬å¸APIï¼ˆå¯é€‰ï¼‰

```bash
python test_company_api.py
```

ç¡®è®¤APIè¿æ¥æ­£å¸¸åç»§ç»­ã€‚

### æ­¥éª¤4: å¯åŠ¨åç«¯æœåŠ¡

```bash
python app_flask.py
```

æˆ–ä½¿ç”¨ä¸€é”®å¯åŠ¨:
```bash
ä¸€é”®å¯åŠ¨.bat
```

æœåŠ¡å°†è¿è¡Œåœ¨: http://localhost:5000

### æ­¥éª¤5: ç”ŸæˆäºŒç»´ç 

```bash
python generate_qrcode.py
```

### æ­¥éª¤6: æ‰‹æœºæ‰«ç è®¿é—®

ç”¨æ‰‹æœºæ‰«æç”Ÿæˆçš„äºŒç»´ç ï¼Œå³å¯çœ‹åˆ°çˆ†æ–‡æ¸…å•

---

## ğŸ“± ä½¿ç”¨æµç¨‹

```
æ‰‹æœºæ‰«ç  â†’ æµè§ˆçˆ†æ–‡ â†’ ç‚¹å‡»"å‘å¸ƒåˆ°å†…å®¹åº“"
   â†“
è‡ªåŠ¨è°ƒç”¨å…¬å¸API â†’ åˆ›å»ºç¬”è®°
   â†“
æ˜¾ç¤ºå‘å¸ƒç»“æœ âœ…
```

---

## ğŸ”§ APIé…ç½®

### å…¬å¸APIä¿¡æ¯

**æµ‹è¯•ç¯å¢ƒ:**
```
URL: http://contenthub-test.applesay.cn/app-api/hotword/note-review/create
```

**APIå‚æ•°:**
```json
{
  "title": "æ ‡é¢˜",
  "content": "æ­£æ–‡å†…å®¹",
  "tags": "æ ‡ç­¾1,æ ‡ç­¾2,æ ‡ç­¾3",
  "noteImage": "å›¾ç‰‡URL1,å›¾ç‰‡URL2"
}
```

### ä¿®æ”¹APIåœ°å€

**æ–¹å¼1: ä¿®æ”¹ä»£ç **
ç¼–è¾‘ `app_flask.py` ç¬¬32è¡Œ:
```python
'COMPANY_API_URL': 'http://your-api-url.com/path',
```

**æ–¹å¼2: ç¯å¢ƒå˜é‡**

Windows:
```bash
set COMPANY_API_URL=http://your-api-url.com/path
python app_flask.py
```

Linux/Mac:
```bash
export COMPANY_API_URL=http://your-api-url.com/path
python app_flask.py
```

---

## ğŸ“Š æ•°æ®å¤„ç†è¯´æ˜

### è‡ªåŠ¨å¤„ç†çš„æ ¼å¼

1. **æ ‡ç­¾æå–**
   - è‡ªåŠ¨ä»æ­£æ–‡æå– `#æ ‡ç­¾`
   - å¦‚æœæ²¡æœ‰æ ‡ç­¾ï¼Œä½¿ç”¨é»˜è®¤æ ‡ç­¾: `AIæ•™è‚²,æµ·å¤–æ•™è‚²,å¹²è´§åˆ†äº«`

2. **å†…å®¹æ¸…ç†**
   - ä¿ç•™å¸¸ç”¨emojiï¼ˆğŸ”¥ğŸ’¡âœ¨ç­‰ï¼‰
   - ç§»é™¤ç‰¹æ®Šå­—ç¬¦
   - ä¿ç•™ä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—

3. **å›¾ç‰‡å¤„ç†**
   - å½“å‰ç‰ˆæœ¬å›¾ç‰‡å­—æ®µä¸ºç©º
   - å¯ä»¥æ‰‹åŠ¨æ·»åŠ å›¾ç‰‡URL

---

## ğŸ§ª æµ‹è¯•åŠŸèƒ½

### æµ‹è¯•1: æµ‹è¯•å…¬å¸APIè¿æ¥

```bash
python test_company_api.py
```

è¿™å°†å‘é€ä¸€ä¸ªæµ‹è¯•è¯·æ±‚åˆ°å…¬å¸APIï¼Œç¡®è®¤è¿æ¥æ­£å¸¸ã€‚

### æµ‹è¯•2: æµ‹è¯•å®Œæ•´å‘å¸ƒæµç¨‹

1. å¯åŠ¨æœåŠ¡: `python app_flask.py`
2. æ‰“å¼€æµè§ˆå™¨: http://localhost:5000/h5/index.html
3. ç‚¹å‡»ä»»æ„çˆ†æ–‡çš„"å‘å¸ƒåˆ°å†…å®¹åº“"æŒ‰é’®
4. æŸ¥çœ‹å‘å¸ƒç»“æœ

---

## ğŸ“‚ é¡¹ç›®æ–‡ä»¶ç»“æ„

```
topicgenerater/
â”œâ”€â”€ app_flask.py              # åç«¯APIæœåŠ¡ï¼ˆå·²æ›´æ–°ï¼‰
â”œâ”€â”€ h5/
â”‚   â””â”€â”€ index.html            # å‰ç«¯H5é¡µé¢ï¼ˆå·²æ›´æ–°ï¼‰
â”œâ”€â”€ test_company_api.py       # APIæµ‹è¯•å·¥å…·ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ .env.company              # é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ convert_to_csv.py         # CSVè½¬æ¢å·¥å…·
â”œâ”€â”€ generate_qrcode.py        # äºŒç»´ç ç”Ÿæˆå·¥å…·
â”œâ”€â”€ output/
â”‚   â”œâ”€â”€ xiaohongshu_posts_*.csv      # çˆ†æ–‡æ•°æ®
â”‚   â””â”€â”€ xiaohongshu_qrcode_*.png      # äºŒç»´ç 
â””â”€â”€ å…¬å¸APIç‰ˆæœ¬ä½¿ç”¨æŒ‡å—.md          # æœ¬æ–‡æ¡£
```

---

## ğŸ” APIæ¥å£æ–‡æ¡£

### 1. è·å–çˆ†æ–‡åˆ—è¡¨
```
GET /api/posts
```

### 2. è·å–å•æ¡çˆ†æ–‡
```
GET /api/posts/{id}
```

### 3. å‘å¸ƒåˆ°å…¬å¸å†…å®¹åº“ â­
```
POST /api/publish-to-company
```

**è¯·æ±‚ä½“:**
```json
{
  "post_id": 1,
  "images": ["url1", "url2"]  // å¯é€‰
}
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "status": "success",
  "message": "å‘å¸ƒæˆåŠŸ",
  "data": {
    "post_id": 1,
    "company_response": {...}
  }
}
```

---

## âš ï¸  å¸¸è§é—®é¢˜

### Q1: APIè°ƒç”¨å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**æ£€æŸ¥æ¸…å•:**
1. ç¡®è®¤APIåœ°å€æ­£ç¡®
2. ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
3. è¿è¡Œ `python test_company_api.py` æµ‹è¯•è¿æ¥
4. æŸ¥çœ‹åç«¯æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

### Q2: å‘å¸ƒåæ²¡æœ‰æ•°æ®ï¼Ÿ

**å¯èƒ½åŸå› :**
- APIè¿”å›äº†é”™è¯¯ä½†çŠ¶æ€ç ä»æ˜¯200
- æ•°æ®æ ¼å¼ä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆ:**
- æŸ¥çœ‹å‘å¸ƒç»“æœçš„ `company_response` å­—æ®µ
- æ£€æŸ¥å…¬å¸APIçš„å®é™…å“åº”æ ¼å¼

### Q3: æ ‡ç­¾æå–ä¸å‡†ç¡®ï¼Ÿ

**æ‰‹åŠ¨ä¿®æ”¹:**
åœ¨ `app_flask.py` ç¬¬333è¡Œä¿®æ”¹é»˜è®¤æ ‡ç­¾:
```python
tags = ','.join(hashtags) if hashtags else 'ä½ çš„é»˜è®¤æ ‡ç­¾1,ä½ çš„é»˜è®¤æ ‡ç­¾2'
```

### Q4: æƒ³æ·»åŠ å›¾ç‰‡URLï¼Ÿ

**æ–¹æ³•1: åœ¨å‘å¸ƒæ—¶æ·»åŠ **
å‰ç«¯ä¿®æ”¹ï¼Œä¼ é€’imageså‚æ•°ã€‚

**æ–¹æ³•2: åç«¯å›ºå®šæ·»åŠ **
åœ¨ `app_flask.py` ç¬¬345è¡Œä¿®æ”¹:
```python
payload['noteImage'] = "https://your-image-url.com/image1.jpg,https://your-image-url.com/image2.jpg"
```

---

## ğŸ¯ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### ä½¿ç”¨äº‘æœåŠ¡å™¨

1. è´­ä¹°äº‘æœåŠ¡å™¨ï¼ˆé˜¿é‡Œäº‘/è…¾è®¯äº‘ï¼‰
2. å®‰è£…Pythonç¯å¢ƒå’Œä¾èµ–
3. ä¸Šä¼ ä»£ç 
4. ä¿®æ”¹APIåœ°å€ä¸ºç”Ÿäº§ç¯å¢ƒåœ°å€
5. ä½¿ç”¨systemdç®¡ç†æœåŠ¡

### systemdé…ç½®ç¤ºä¾‹

```ini
[Unit]
Description=Content Publisher Service
After=network.target

[Service]
Type=simple
User=your_user
WorkingDirectory=/path/to/topicgenerater
Environment="COMPANY_API_URL=http://production-api.com/path"
ExecStart=/usr/bin/python3 app_flask.py
Restart=always

[Install]
WantedBy=multi-user.target
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### ä¿®æ”¹APIå“åº”å¤„ç†

å¦‚æœå…¬å¸APIçš„å“åº”æ ¼å¼ä¸åŒï¼Œä¿®æ”¹ `app_flask.py` ç¬¬363-371è¡Œ:

```python
if response.status_code == 200:
    # æ ¹æ®å®é™…å“åº”æ ¼å¼ä¿®æ”¹
    return jsonify({
        'status': 'success',
        'message': 'å‘å¸ƒæˆåŠŸ',
        'data': {
            'post_id': post_id,
            'company_response': response.json()
        }
    })
```

### æ·»åŠ è®¤è¯

å¦‚æœAPIéœ€è¦è®¤è¯ï¼Œåœ¨ `app_flask.py` ç¬¬356è¡Œæ·»åŠ headers:

```python
response = requests.post(
    CONFIG['COMPANY_API_URL'],
    headers={
        'Content-Type': 'application/json',
        'Authorization': 'Bearer your-token'  # æ·»åŠ è®¤è¯
    },
    json=payload,
    timeout=30
)
```

---

## ğŸ‰ å®Œæˆå•¦ï¼

ç°åœ¨æ‚¨å·²ç»æ‹¥æœ‰äº†ä¸€ä¸ªå®Œæ•´çš„çˆ†æ–‡å‘å¸ƒç³»ç»Ÿï¼š

1. âœ… è‡ªåŠ¨ç”Ÿæˆçˆ†æ–‡
2. âœ… æ‰‹æœºç«¯æµè§ˆ
3. âœ… ä¸€é”®å‘å¸ƒåˆ°å†…å®¹åº“
4. âœ… äºŒç»´ç æ‰«ç è®¿é—®

---

**ç¥ä½¿ç”¨æ„‰å¿«ï¼ğŸ”¥**

---

## ğŸ“ æ›´æ–°æ—¥å¿—

**v1.0 - 2026-01-10**
- âœ… é›†æˆå…¬å¸API
- âœ… è‡ªåŠ¨æå–æ ‡ç­¾
- âœ… å†…å®¹æ ¼å¼æ¸…ç†
- âœ… H5é¡µé¢æ›´æ–°
- âœ… æ·»åŠ æµ‹è¯•å·¥å…·
