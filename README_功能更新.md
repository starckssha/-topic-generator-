# 爆文系统功能更新说明

## 🎉 新增功能

### 1. 📅 按天查看历史爆文

**功能描述：**
- 可以按日期筛选查看不同日期的爆文内容
- PC管理页面增加日期选择器
- 自动加载所有可用日期列表

**使用方法：**
1. 访问 http://192.168.31.8:5000/manager
2. 在页面顶部看到日期选择器
3. 选择想要查看的日期
4. 系统自动显示该日期的所有爆文

**API端点：**
```bash
# 获取所有可用日期
GET /api/dates

# 按日期获取爆文列表
GET /api/posts?date=20260110
```

### 2. 🚫 话题自动去重

**功能描述：**
- 自动记录已使用的话题
- 生成新爆文时，自动过滤30天内已使用的话题
- 避免重复使用相同话题，保证内容新鲜度

**工作原理：**
1. 话题追踪器保存到 `output/used_topics.json`
2. 每次生成爆文时检查话题是否已使用
3. 生成完成后自动标记话题为已使用
4. 可自定义去重天数（默认30天）

**查看统计：**
```bash
# 生成爆文时会自动显示话题使用统计
# 示例输出：
======================================================================
📊 话题使用统计
======================================================================
累计使用话题数: 5
总使用记录数: 5
最近7天使用: 5
最近30天使用: 5
======================================================================
```

**文件结构：**
```
output/
├── used_topics.json          # 已使用话题记录
├── xiaohongshu_posts_*.csv   # 爆文数据文件
└── hot_topics_*.md           # 热点话题文件
```

## 📁 文件说明

### 新增文件

1. **topic_tracker.py** - 话题追踪管理器
   - 记录已使用的话题
   - 检查话题是否重复
   - 提供统计信息

2. **output/used_topics.json** - 话题数据库
   ```json
   {
     "ai在教育中的应用": [
       {
         "used_at": "2026-01-10T14:35:10",
         "original_title": "AI在教育中的应用",
         "metadata": {
           "platform": "Hacker News",
           "category": "AI教育",
           "url": "...",
           "generated_at": "2026-01-10T14:35:10"
         }
       }
     ]
   }
   ```

### 修改文件

1. **app_flask.py** - 后端API
   - 新增 `/api/dates` 端点
   - `/api/posts` 支持日期参数

2. **templates/manager.html** - PC管理页面
   - 添加日期选择器
   - 支持按日期加载爆文

3. **xiaohongshu_generator.py** - 爆文生成器
   - 集成话题追踪器
   - 自动过滤已使用话题
   - 自动标记新话题

## 🔄 完整工作流程

### 生成新爆文（带去重）

```bash
# 1. 抓取热点话题
python main.py

# 2. 生成爆文（自动过滤已使用话题）
python xiaohongshu_generator.py

# 输出示例：
# ✓ 原始话题数: 10
# ✓ 未使用话题数: 5
# ✓ 过滤掉: 5 个已使用话题
```

### 查看历史爆文

1. 打开 http://192.168.31.8:5000/manager
2. 使用日期选择器切换不同日期
3. 查看每个日期的爆文和二维码
4. 手机扫码即可发布

## 💡 高级用法

### 自定义去重天数

编辑 `xiaohongshu_generator.py`:

```python
# 默认30天，可修改为其他值
unused_topics = tracker.filter_unused_topics(parenting_topics, days=7)  # 7天
unused_topics = tracker.filter_unused_topics(parenting_topics, days=60)  # 60天
```

### 手动管理话题数据库

```python
from topic_tracker import TopicTracker

# 初始化追踪器
tracker = TopicTracker()

# 检查话题是否已使用
is_used = tracker.is_topic_used("AI在教育中的应用")

# 手动标记话题
tracker.mark_topic_used("AI在教育中的应用", {
    'platform': 'Hacker News',
    'category': 'AI教育'
})

# 获取统计信息
stats = tracker.get_stats()
print(stats)

# 过滤话题列表
unused = tracker.filter_unused_topics(topics_list, days=30)
```

### 清空话题记录

如果需要重新开始，可以直接删除文件：
```bash
rm output/used_topics.json
```

## 🐛 故障排查

### 问题1：日期选择器显示"暂无数据"

**原因：** output目录下没有爆文CSV文件

**解决：** 先运行 `python xiaohongshu_generator.py` 生成爆文

### 问题2：所有话题都被过滤

**原因：** 所有筛选的话题都在30天内已使用

**解决：**
1. 等待新的热点话题出现
2. 调整 `days` 参数查看更早的话题
3. 删除 `output/used_topics.json` 重新开始

### 问题3：生成爆文时报错

**原因：** 可能是话题追踪文件损坏

**解决：**
```bash
# 删除追踪文件
rm output/used_topics.json

# 重新生成
python xiaohongshu_generator.py
```

## 📊 数据统计示例

生成爆文时会显示详细统计：

```
======================================================================
📊 话题使用统计
======================================================================
累计使用话题数: 15
总使用记录数: 15
最近7天使用: 5
最近30天使用: 15
======================================================================

[*] 正在过滤已使用的话题（30天内）...
✓ 原始话题数: 20
✓ 未使用话题数: 5
✓ 过滤掉: 15 个已使用话题

✓ 为您生成 5 个小红书爆文内容
```

## 🎯 最佳实践

1. **每天生成一次爆文**：避免话题重复，保持内容新鲜度
2. **定期查看历史**：使用日期选择器查看历史爆文表现
3. **关注话题统计**：了解话题使用情况，调整策略
4. **备份话题数据**：定期备份 `used_topics.json`

## 🚀 未来优化方向

- [ ] 支持手动标记话题为"不需要"
- [ ] 添加话题评分功能
- [ ] 支持按平台、分类筛选
- [ ] 添加话题推荐算法
- [ ] Web界面管理话题数据库

---

**更新时间：** 2026-01-10
**版本：** v2.0
